
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Rico's Blog</title>
  <meta name="author" content="Henri Gomez">

  
  <meta name="description" content="I&#8217;m using Jenkins to build RPMs with free-style scripts. Decent RPM packager should sign his RPMs so they could be checked by yum/zypper tools &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://hgomez.github.com/blog/page/2/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Rico's Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-35223600-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <div id="logo">
  	<div id="logoLeft">{</div>
  	<div id="logoText">mob</div>
  	<div id="logoRight">}</div>
  	<div class="clear"></div>
  </div>
  <h1><a href="/">Rico's Blog</a></h1>
  
    <h2>Continuous Integration, Delivery, OSX, OpenJDK, Tomcat and much more.</h2>
  
  <div class="clear"></div>
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:hgomez.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/12/28/batch-rpm-signing/">Batch Rpm Signing</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-12-28T18:05:42+01:00" pubdate data-updated="true">Dec 28<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&#8217;m using <a href="http://jenkins-ci.org/">Jenkins</a> to build RPMs with free-style scripts.</p>

<p>Decent RPM packager should sign his RPMs so they could be checked by yum/zypper tools.</p>

<p>Here you could be in trouble since rpm signing require a password to be passed in command line :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>rpm --addsign -D <span class="s2">&quot;_signature gpg&quot;</span> -D <span class="s2">&quot;_gpg_name packagers@myforge.org&quot;</span> RPMS/noarch/myjenkins-1.0.0-1.noarch.rpm&lt;br /&gt;
</span><span class='line'>Enter pass phrase:&lt;br /&gt;
</span></code></pre></td></tr></table></div></figure>


<p>It&#8217;s quite problematic for a RPM build factory.</p>

<p>After digging around Internet, best solution appears to be using <a href="http://expect.sourceforge.net/">expect</a> and I developped a simple script for such purpose with following constraints :</p>

<ul>
<li><p>packager gpg name should be parametized (to avoid injecting it in ~/.rpmmacros)</p></li>
<li><p>gpg passphrase should be provided to command line (could be read from a secret file)</p></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/usr/bin/expect -f</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="c"># rpmsign-batch.expect : expect powered rpm signing command</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'>
</span><span class='line'>proc usage <span class="o">{}</span> <span class="o">{</span>
</span><span class='line'>        send_user <span class="s2">&quot;Usage: rpmsign-batch.expect gpgname passphrase rpmfile\n\n&quot;</span>
</span><span class='line'>        <span class="nb">exit</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="o">{[</span>llength <span class="nv">$argv</span><span class="o">]</span>!<span class="o">=</span>3<span class="o">}</span> usage
</span><span class='line'>
</span><span class='line'><span class="nb">set </span>gpgname <span class="o">[</span>lrange <span class="nv">$argv</span> 0 0<span class="o">]</span>
</span><span class='line'><span class="nb">set </span>passphrase <span class="o">[</span>lrange <span class="nv">$argv</span> 1 1<span class="o">]</span>
</span><span class='line'><span class="nb">set </span>rpmfile <span class="o">[</span>lrange <span class="nv">$argv</span> 2 2<span class="o">]</span>
</span><span class='line'>
</span><span class='line'>send_user <span class="s2">&quot;passphrase=$passphrase gpgname=$gpgname\n&quot;</span>
</span><span class='line'>
</span><span class='line'>spawn rpm --addsign -D <span class="s2">&quot;_signature gpg&quot;</span> -D <span class="s2">&quot;_gpg_name $gpgname&quot;</span> <span class="nv">$rpmfile</span>
</span><span class='line'>expect -exact <span class="s2">&quot;Enter pass phrase: &quot;</span>
</span><span class='line'>send -- <span class="s2">&quot;$passphrase\r&quot;</span>
</span><span class='line'>expect eof
</span></code></pre></td></tr></table></div></figure>


<p>You could then use it to sign rpms from your freestyle jobs like :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Password provided in clear in job (weird)</span>
</span><span class='line'>rpmsign-batch.expect packagers@myforge.org mypassphrase RPMS/noarch/myjenkins-1.0.0-1.noarch.rpm
</span><span class='line'>
</span><span class='line'><span class="c"># Password grabbed from a secret file (better)</span>
</span><span class='line'><span class="nv">PASSPHRASE</span><span class="o">=</span><span class="sb">`</span>cat /my/secret-passphrase-file<span class="sb">`</span>
</span><span class='line'>rpmsign-batch.expect packagers@myforge.org <span class="nv">$PASSPHRASE</span> RPMS/noarch/myjenkins-1.0.0-1.noarch.rpm
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/11/03/iozone-and-gnuplot-4-x/">Iozone and Gnuplot 4.x</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-11-03T20:16:40+01:00" pubdate data-updated="true">Nov 3<span>rd</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://www.iozone.org/">Iozone </a> is a great tool to mesure performance of filesystem.
You could find 10 examples <a href="http://www.thegeekstuff.com/2011/05/iozone-examples/">here</a>.</p>

<p>In it latest version, 3.97, it came with reporting tools, <strong>report.pl</strong> and <strong>gengnuplot.sh</strong>, who use gnuplot to render images.</p>

<p><img class="center" src="/images/2d-recrewrite.png">
<img class="center" src="/images/recrewrite.png"></p>

<p>Due to changes in GnuPlot 4.x, <strong>report.pl</strong> and <strong>gnu3d.dem</strong> need to be updated to works.
Also you may get only <strong>8 metrics</strong> in reports instead of <strong>15</strong> expected in latest release of <strong>report.pl</strong></p>

<h2>gnu3d.dem</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
<span class='line-number'>240</span>
<span class='line-number'>241</span>
<span class='line-number'>242</span>
<span class='line-number'>243</span>
<span class='line-number'>244</span>
<span class='line-number'>245</span>
<span class='line-number'>246</span>
<span class='line-number'>247</span>
<span class='line-number'>248</span>
<span class='line-number'>249</span>
<span class='line-number'>250</span>
<span class='line-number'>251</span>
<span class='line-number'>252</span>
<span class='line-number'>253</span>
<span class='line-number'>254</span>
<span class='line-number'>255</span>
<span class='line-number'>256</span>
<span class='line-number'>257</span>
<span class='line-number'>258</span>
<span class='line-number'>259</span>
<span class='line-number'>260</span>
<span class='line-number'>261</span>
<span class='line-number'>262</span>
<span class='line-number'>263</span>
<span class='line-number'>264</span>
<span class='line-number'>265</span>
<span class='line-number'>266</span>
<span class='line-number'>267</span>
<span class='line-number'>268</span>
<span class='line-number'>269</span>
<span class='line-number'>270</span>
<span class='line-number'>271</span>
<span class='line-number'>272</span>
<span class='line-number'>273</span>
<span class='line-number'>274</span>
<span class='line-number'>275</span>
<span class='line-number'>276</span>
<span class='line-number'>277</span>
<span class='line-number'>278</span>
<span class='line-number'>279</span>
<span class='line-number'>280</span>
<span class='line-number'>281</span>
<span class='line-number'>282</span>
<span class='line-number'>283</span>
<span class='line-number'>284</span>
<span class='line-number'>285</span>
<span class='line-number'>286</span>
<span class='line-number'>287</span>
<span class='line-number'>288</span>
<span class='line-number'>289</span>
<span class='line-number'>290</span>
<span class='line-number'>291</span>
<span class='line-number'>292</span>
<span class='line-number'>293</span>
<span class='line-number'>294</span>
<span class='line-number'>295</span>
</pre></td><td class='code'><pre><code class='perl'><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="c1"># $Id: 3D plot of performance</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="c1"># Processes files that were created by Generate_Graphs</span>
</span><span class='line'><span class="c1"># and displays the results. Also, saves a postscript copy.</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="c1"># Don Capps</span>
</span><span class='line'>
</span><span class='line'><span class="n">set</span> <span class="n">terminal</span> <span class="n">x11</span>
</span><span class='line'><span class="n">set</span> <span class="n">title</span> <span class="s">&quot;Iozone performance&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">grid</span> <span class="ow">lt</span> <span class="mi">2</span> <span class="n">lw</span> <span class="mi">1</span>
</span><span class='line'><span class="n">set</span> <span class="n">surface</span>
</span><span class='line'><span class="n">set</span> <span class="n">parametric</span>
</span><span class='line'><span class="n">set</span> <span class="n">xtics</span>
</span><span class='line'><span class="n">set</span> <span class="n">ytics</span>
</span><span class='line'><span class="n">set</span> <span class="n">logscale</span> <span class="n">x</span> <span class="mi">2</span>
</span><span class='line'><span class="n">set</span> <span class="n">logscale</span> <span class="n">y</span> <span class="mi">2</span>
</span><span class='line'><span class="n">set</span> <span class="n">autoscale</span> <span class="n">z</span>
</span><span class='line'><span class="c1">#set xrange [2.**5:2.**24]</span>
</span><span class='line'><span class="n">set</span> <span class="n">xlabel</span> <span class="s">&quot;File size in 2^n KBytes&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">ylabel</span> <span class="s">&quot;Record size in 2^n Kbytes&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">zlabel</span> <span class="s">&quot;Kbytes/sec&quot;</span>
</span><span class='line'><span class="c1">#set data style lines</span>
</span><span class='line'><span class="n">set</span> <span class="n">style</span> <span class="n">data</span> <span class="n">lines</span>
</span><span class='line'><span class="n">set</span> <span class="n">dgrid3d</span> <span class="mi">80</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span><span class="mi">3</span>
</span><span class='line'><span class="n">splot</span> <span class="s">&#39;write/iozone_gen_out.gnuplot&#39;</span> <span class="n">title</span> <span class="s">&quot;Write performance&quot;</span>
</span><span class='line'><span class="n">pause</span> <span class="o">-</span><span class="mi">1</span> <span class="s">&quot;Hit return to continue&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">terminal</span> <span class="n">postscript</span> <span class="n">color</span>
</span><span class='line'><span class="n">set</span> <span class="n">output</span> <span class="s">&quot;write/write.ps&quot;</span>
</span><span class='line'><span class="n">splot</span> <span class="s">&#39;write/iozone_gen_out.gnuplot&#39;</span> <span class="n">title</span> <span class="s">&quot;Write performance&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="n">set</span> <span class="n">terminal</span> <span class="n">x11</span>
</span><span class='line'><span class="n">set</span> <span class="n">title</span> <span class="s">&quot;Iozone performance&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">grid</span> <span class="ow">lt</span> <span class="mi">2</span> <span class="n">lw</span> <span class="mi">1</span>
</span><span class='line'><span class="n">set</span> <span class="n">surface</span>
</span><span class='line'><span class="n">set</span> <span class="n">xtics</span>
</span><span class='line'><span class="n">set</span> <span class="n">ytics</span>
</span><span class='line'><span class="n">set</span> <span class="n">logscale</span> <span class="n">x</span> <span class="mi">2</span>
</span><span class='line'><span class="n">set</span> <span class="n">logscale</span> <span class="n">y</span> <span class="mi">2</span>
</span><span class='line'><span class="n">set</span> <span class="n">autoscale</span> <span class="n">z</span>
</span><span class='line'><span class="c1">#set xrange [2.**5:2.**24]</span>
</span><span class='line'><span class="n">set</span> <span class="n">xlabel</span> <span class="s">&quot;File size in 2^n KBytes&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">ylabel</span> <span class="s">&quot;Record size in 2^n Kbytes&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">zlabel</span> <span class="s">&quot;Kbytes/sec&quot;</span>
</span><span class='line'><span class="c1">#set data style lines</span>
</span><span class='line'><span class="n">set</span> <span class="n">style</span> <span class="n">data</span> <span class="n">lines</span>
</span><span class='line'><span class="n">set</span> <span class="n">dgrid3d</span> <span class="mi">80</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span><span class="mi">3</span>
</span><span class='line'><span class="n">splot</span> <span class="s">&#39;rewrite/iozone_gen_out.gnuplot&#39;</span> <span class="n">using</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span> <span class="n">title</span> <span class="s">&quot;ReWrite performance&quot;</span> <span class="n">with</span> <span class="n">lines</span>
</span><span class='line'><span class="n">pause</span> <span class="o">-</span><span class="mi">1</span> <span class="s">&quot;Hit return to continue&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">terminal</span> <span class="n">postscript</span> <span class="n">color</span>
</span><span class='line'><span class="n">set</span> <span class="n">output</span> <span class="s">&quot;rewrite/rewrite.ps&quot;</span>
</span><span class='line'><span class="n">splot</span> <span class="s">&#39;rewrite/iozone_gen_out.gnuplot&#39;</span> <span class="n">using</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span> <span class="n">title</span> <span class="s">&quot;ReWrite performance&quot;</span> <span class="n">with</span> <span class="n">lines</span>
</span><span class='line'>
</span><span class='line'><span class="n">set</span> <span class="n">terminal</span> <span class="n">x11</span>
</span><span class='line'><span class="n">set</span> <span class="n">title</span> <span class="s">&quot;Iozone performance&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">grid</span> <span class="ow">lt</span> <span class="mi">2</span> <span class="n">lw</span> <span class="mi">1</span>
</span><span class='line'><span class="n">set</span> <span class="n">surface</span>
</span><span class='line'><span class="n">set</span> <span class="n">xtics</span>
</span><span class='line'><span class="n">set</span> <span class="n">ytics</span>
</span><span class='line'><span class="n">set</span> <span class="n">logscale</span> <span class="n">x</span> <span class="mi">2</span>
</span><span class='line'><span class="n">set</span> <span class="n">logscale</span> <span class="n">y</span> <span class="mi">2</span>
</span><span class='line'><span class="n">set</span> <span class="n">autoscale</span> <span class="n">z</span>
</span><span class='line'><span class="c1">#set xrange [2.**5:2.**24]</span>
</span><span class='line'><span class="n">set</span> <span class="n">xlabel</span> <span class="s">&quot;File size in 2^n KBytes&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">ylabel</span> <span class="s">&quot;Record size in 2^n Kbytes&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">zlabel</span> <span class="s">&quot;Kbytes/sec&quot;</span>
</span><span class='line'><span class="c1">#set data style lines</span>
</span><span class='line'><span class="n">set</span> <span class="n">style</span> <span class="n">data</span> <span class="n">lines</span>
</span><span class='line'><span class="n">set</span> <span class="n">dgrid3d</span> <span class="mi">80</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span><span class="mi">3</span>
</span><span class='line'><span class="n">splot</span> <span class="s">&#39;read/iozone_gen_out.gnuplot&#39;</span> <span class="n">using</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span> <span class="n">title</span> <span class="s">&quot;Read performance&quot;</span> <span class="n">with</span> <span class="n">lines</span>
</span><span class='line'><span class="n">pause</span> <span class="o">-</span><span class="mi">1</span> <span class="s">&quot;Hit return to continue&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">terminal</span> <span class="n">postscript</span> <span class="n">color</span>
</span><span class='line'><span class="n">set</span> <span class="n">output</span> <span class="s">&quot;read/read.ps&quot;</span>
</span><span class='line'><span class="n">splot</span> <span class="s">&#39;read/iozone_gen_out.gnuplot&#39;</span> <span class="n">using</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span> <span class="n">title</span> <span class="s">&quot;Read performance&quot;</span> <span class="n">with</span> <span class="n">lines</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="n">set</span> <span class="n">terminal</span> <span class="n">x11</span>
</span><span class='line'><span class="n">set</span> <span class="n">title</span> <span class="s">&quot;Iozone performance&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">grid</span> <span class="ow">lt</span> <span class="mi">2</span> <span class="n">lw</span> <span class="mi">1</span>
</span><span class='line'><span class="n">set</span> <span class="n">surface</span>
</span><span class='line'><span class="n">set</span> <span class="n">xtics</span>
</span><span class='line'><span class="n">set</span> <span class="n">ytics</span>
</span><span class='line'><span class="n">set</span> <span class="n">logscale</span> <span class="n">x</span> <span class="mi">2</span>
</span><span class='line'><span class="n">set</span> <span class="n">logscale</span> <span class="n">y</span> <span class="mi">2</span>
</span><span class='line'><span class="n">set</span> <span class="n">autoscale</span> <span class="n">z</span>
</span><span class='line'><span class="c1">#set xrange [2.**5:2.**24]</span>
</span><span class='line'><span class="n">set</span> <span class="n">xlabel</span> <span class="s">&quot;File size in 2^n KBytes&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">ylabel</span> <span class="s">&quot;Record size in 2^n Kbytes&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">zlabel</span> <span class="s">&quot;Kbytes/sec&quot;</span>
</span><span class='line'><span class="c1">#set data style lines</span>
</span><span class='line'><span class="n">set</span> <span class="n">style</span> <span class="n">data</span> <span class="n">lines</span>
</span><span class='line'><span class="n">set</span> <span class="n">dgrid3d</span> <span class="mi">80</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span><span class="mi">3</span>
</span><span class='line'><span class="n">splot</span> <span class="s">&#39;reread/iozone_gen_out.gnuplot&#39;</span> <span class="n">using</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span> <span class="n">title</span> <span class="s">&quot;Reread performance&quot;</span> <span class="n">with</span> <span class="n">lines</span>
</span><span class='line'><span class="n">pause</span> <span class="o">-</span><span class="mi">1</span> <span class="s">&quot;Hit return to continue&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">terminal</span> <span class="n">postscript</span> <span class="n">color</span>
</span><span class='line'><span class="n">set</span> <span class="n">output</span> <span class="s">&quot;reread/reread.ps&quot;</span>
</span><span class='line'><span class="n">splot</span> <span class="s">&#39;reread/iozone_gen_out.gnuplot&#39;</span> <span class="n">using</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span> <span class="n">title</span> <span class="s">&quot;Reread performance&quot;</span> <span class="n">with</span> <span class="n">lines</span>
</span><span class='line'>
</span><span class='line'><span class="n">set</span> <span class="n">terminal</span> <span class="n">x11</span>
</span><span class='line'><span class="n">set</span> <span class="n">title</span> <span class="s">&quot;Iozone performance&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">grid</span> <span class="ow">lt</span> <span class="mi">2</span> <span class="n">lw</span> <span class="mi">1</span>
</span><span class='line'><span class="n">set</span> <span class="n">surface</span>
</span><span class='line'><span class="n">set</span> <span class="n">xtics</span>
</span><span class='line'><span class="n">set</span> <span class="n">ytics</span>
</span><span class='line'><span class="n">set</span> <span class="n">logscale</span> <span class="n">x</span> <span class="mi">2</span>
</span><span class='line'><span class="n">set</span> <span class="n">logscale</span> <span class="n">y</span> <span class="mi">2</span>
</span><span class='line'><span class="n">set</span> <span class="n">autoscale</span> <span class="n">z</span>
</span><span class='line'><span class="c1">#set xrange [2.**5:2.**24]</span>
</span><span class='line'><span class="n">set</span> <span class="n">xlabel</span> <span class="s">&quot;File size in 2^n KBytes&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">ylabel</span> <span class="s">&quot;Record size in 2^n Kbytes&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">zlabel</span> <span class="s">&quot;Kbytes/sec&quot;</span>
</span><span class='line'><span class="c1">#set data style lines</span>
</span><span class='line'><span class="n">set</span> <span class="n">style</span> <span class="n">data</span> <span class="n">lines</span>
</span><span class='line'><span class="n">set</span> <span class="n">dgrid3d</span> <span class="mi">80</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span><span class="mi">3</span>
</span><span class='line'><span class="n">splot</span> <span class="s">&#39;randread/iozone_gen_out.gnuplot&#39;</span> <span class="n">using</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span> <span class="n">title</span> <span class="s">&quot;Random read performance&quot;</span> <span class="n">with</span> <span class="n">lines</span>
</span><span class='line'><span class="n">pause</span> <span class="o">-</span><span class="mi">1</span> <span class="s">&quot;Hit return to continue&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">terminal</span> <span class="n">postscript</span> <span class="n">color</span>
</span><span class='line'><span class="n">set</span> <span class="n">output</span> <span class="s">&quot;randread/randread.ps&quot;</span>
</span><span class='line'><span class="n">splot</span> <span class="s">&#39;randread/iozone_gen_out.gnuplot&#39;</span> <span class="n">using</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span> <span class="n">title</span> <span class="s">&quot;Random read performance&quot;</span> <span class="n">with</span> <span class="n">lines</span>
</span><span class='line'>
</span><span class='line'><span class="n">set</span> <span class="n">terminal</span> <span class="n">x11</span>
</span><span class='line'><span class="n">set</span> <span class="n">title</span> <span class="s">&quot;Iozone performance&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">grid</span> <span class="ow">lt</span> <span class="mi">2</span> <span class="n">lw</span> <span class="mi">1</span>
</span><span class='line'><span class="n">set</span> <span class="n">surface</span>
</span><span class='line'><span class="n">set</span> <span class="n">xtics</span>
</span><span class='line'><span class="n">set</span> <span class="n">ytics</span>
</span><span class='line'><span class="n">set</span> <span class="n">logscale</span> <span class="n">x</span> <span class="mi">2</span>
</span><span class='line'><span class="n">set</span> <span class="n">logscale</span> <span class="n">y</span> <span class="mi">2</span>
</span><span class='line'><span class="n">set</span> <span class="n">autoscale</span> <span class="n">z</span>
</span><span class='line'><span class="c1">#set xrange [2.**5:2.**24]</span>
</span><span class='line'><span class="n">set</span> <span class="n">xlabel</span> <span class="s">&quot;File size in 2^n KBytes&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">ylabel</span> <span class="s">&quot;Record size in 2^n Kbytes&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">zlabel</span> <span class="s">&quot;Kbytes/sec&quot;</span>
</span><span class='line'><span class="c1">#set data style lines</span>
</span><span class='line'><span class="n">set</span> <span class="n">style</span> <span class="n">data</span> <span class="n">lines</span>
</span><span class='line'><span class="n">set</span> <span class="n">dgrid3d</span> <span class="mi">80</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span><span class="mi">3</span>
</span><span class='line'><span class="n">splot</span> <span class="s">&#39;randwrite/iozone_gen_out.gnuplot&#39;</span> <span class="n">using</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span> <span class="n">title</span> <span class="s">&quot;Random write performance&quot;</span> <span class="n">with</span> <span class="n">lines</span>
</span><span class='line'><span class="n">pause</span> <span class="o">-</span><span class="mi">1</span> <span class="s">&quot;Hit return to continue&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">terminal</span> <span class="n">postscript</span> <span class="n">color</span>
</span><span class='line'><span class="n">set</span> <span class="n">output</span> <span class="s">&quot;randwrite/randwrite.ps&quot;</span>
</span><span class='line'><span class="n">splot</span> <span class="s">&#39;randwrite/iozone_gen_out.gnuplot&#39;</span> <span class="n">using</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span> <span class="n">title</span> <span class="s">&quot;Random write performance&quot;</span> <span class="n">with</span> <span class="n">lines</span>
</span><span class='line'>
</span><span class='line'><span class="n">set</span> <span class="n">terminal</span> <span class="n">x11</span>
</span><span class='line'><span class="n">set</span> <span class="n">title</span> <span class="s">&quot;Iozone performance&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">grid</span> <span class="ow">lt</span> <span class="mi">2</span> <span class="n">lw</span> <span class="mi">1</span>
</span><span class='line'><span class="n">set</span> <span class="n">surface</span>
</span><span class='line'><span class="n">set</span> <span class="n">xtics</span>
</span><span class='line'><span class="n">set</span> <span class="n">ytics</span>
</span><span class='line'><span class="n">set</span> <span class="n">logscale</span> <span class="n">x</span> <span class="mi">2</span>
</span><span class='line'><span class="n">set</span> <span class="n">logscale</span> <span class="n">y</span> <span class="mi">2</span>
</span><span class='line'><span class="n">set</span> <span class="n">autoscale</span> <span class="n">z</span>
</span><span class='line'><span class="c1">#set xrange [2.**5:2.**24]</span>
</span><span class='line'><span class="n">set</span> <span class="n">xlabel</span> <span class="s">&quot;File size in 2^n KBytes&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">ylabel</span> <span class="s">&quot;Record size in 2^n Kbytes&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">zlabel</span> <span class="s">&quot;Kbytes/sec&quot;</span>
</span><span class='line'><span class="c1">#set data style lines</span>
</span><span class='line'><span class="n">set</span> <span class="n">style</span> <span class="n">data</span> <span class="n">lines</span>
</span><span class='line'><span class="n">set</span> <span class="n">dgrid3d</span> <span class="mi">80</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span><span class="mi">3</span>
</span><span class='line'><span class="n">splot</span> <span class="s">&#39;bkwdread/iozone_gen_out.gnuplot&#39;</span> <span class="n">using</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span> <span class="n">title</span> <span class="s">&quot;Read Backwards performance&quot;</span> <span class="n">with</span> <span class="n">lines</span>
</span><span class='line'><span class="n">pause</span> <span class="o">-</span><span class="mi">1</span> <span class="s">&quot;Hit return to continue&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">terminal</span> <span class="n">postscript</span> <span class="n">color</span>
</span><span class='line'><span class="n">set</span> <span class="n">output</span> <span class="s">&quot;bkwdread/bkwdread.ps&quot;</span>
</span><span class='line'><span class="n">splot</span> <span class="s">&#39;bkwdread/iozone_gen_out.gnuplot&#39;</span> <span class="n">using</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span> <span class="n">title</span> <span class="s">&quot;Read Backwards performance&quot;</span> <span class="n">with</span> <span class="n">lines</span>
</span><span class='line'>
</span><span class='line'><span class="n">set</span> <span class="n">terminal</span> <span class="n">x11</span>
</span><span class='line'><span class="n">set</span> <span class="n">title</span> <span class="s">&quot;Iozone performance&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">grid</span> <span class="ow">lt</span> <span class="mi">2</span> <span class="n">lw</span> <span class="mi">1</span>
</span><span class='line'><span class="n">set</span> <span class="n">surface</span>
</span><span class='line'><span class="n">set</span> <span class="n">xtics</span>
</span><span class='line'><span class="n">set</span> <span class="n">ytics</span>
</span><span class='line'><span class="n">set</span> <span class="n">logscale</span> <span class="n">x</span> <span class="mi">2</span>
</span><span class='line'><span class="n">set</span> <span class="n">logscale</span> <span class="n">y</span> <span class="mi">2</span>
</span><span class='line'><span class="n">set</span> <span class="n">autoscale</span> <span class="n">z</span>
</span><span class='line'><span class="c1">#set xrange [2.**5:2.**24]</span>
</span><span class='line'><span class="n">set</span> <span class="n">xlabel</span> <span class="s">&quot;File size in 2^n KBytes&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">ylabel</span> <span class="s">&quot;Record size in 2^n Kbytes&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">zlabel</span> <span class="s">&quot;Kbytes/sec&quot;</span>
</span><span class='line'><span class="c1">#set data style lines</span>
</span><span class='line'><span class="n">set</span> <span class="n">style</span> <span class="n">data</span> <span class="n">lines</span>
</span><span class='line'><span class="n">set</span> <span class="n">dgrid3d</span> <span class="mi">80</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span><span class="mi">3</span>
</span><span class='line'><span class="n">splot</span> <span class="s">&#39;recrewrite/iozone_gen_out.gnuplot&#39;</span> <span class="n">using</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span> <span class="n">title</span> <span class="s">&quot;Record rewrite performance&quot;</span> <span class="n">with</span> <span class="n">lines</span>
</span><span class='line'><span class="n">pause</span> <span class="o">-</span><span class="mi">1</span> <span class="s">&quot;Hit return to continue&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">terminal</span> <span class="n">postscript</span> <span class="n">color</span>
</span><span class='line'><span class="n">set</span> <span class="n">output</span> <span class="s">&quot;recrewrite/recrewrite.ps&quot;</span>
</span><span class='line'><span class="n">splot</span> <span class="s">&#39;recrewrite/iozone_gen_out.gnuplot&#39;</span> <span class="n">using</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span> <span class="n">title</span> <span class="s">&quot;Record rewrite performance&quot;</span> <span class="n">with</span> <span class="n">lines</span>
</span><span class='line'>
</span><span class='line'><span class="n">set</span> <span class="n">terminal</span> <span class="n">x11</span>
</span><span class='line'><span class="n">set</span> <span class="n">title</span> <span class="s">&quot;Iozone performance&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">grid</span> <span class="ow">lt</span> <span class="mi">2</span> <span class="n">lw</span> <span class="mi">1</span>
</span><span class='line'><span class="n">set</span> <span class="n">surface</span>
</span><span class='line'><span class="n">set</span> <span class="n">xtics</span>
</span><span class='line'><span class="n">set</span> <span class="n">ytics</span>
</span><span class='line'><span class="n">set</span> <span class="n">logscale</span> <span class="n">x</span> <span class="mi">2</span>
</span><span class='line'><span class="n">set</span> <span class="n">logscale</span> <span class="n">y</span> <span class="mi">2</span>
</span><span class='line'><span class="n">set</span> <span class="n">autoscale</span> <span class="n">z</span>
</span><span class='line'><span class="c1">#set xrange [2.**5:2.**24]</span>
</span><span class='line'><span class="n">set</span> <span class="n">xlabel</span> <span class="s">&quot;File size in 2^n KBytes&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">ylabel</span> <span class="s">&quot;Record size in 2^n Kbytes&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">zlabel</span> <span class="s">&quot;Kbytes/sec&quot;</span>
</span><span class='line'><span class="c1">#set data style lines</span>
</span><span class='line'><span class="n">set</span> <span class="n">style</span> <span class="n">data</span> <span class="n">lines</span>
</span><span class='line'><span class="n">set</span> <span class="n">dgrid3d</span> <span class="mi">80</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span><span class="mi">3</span>
</span><span class='line'><span class="n">splot</span> <span class="s">&#39;strideread/iozone_gen_out.gnuplot&#39;</span> <span class="n">using</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span> <span class="n">title</span> <span class="s">&quot;Stride read performance&quot;</span> <span class="n">with</span> <span class="n">lines</span>
</span><span class='line'><span class="n">pause</span> <span class="o">-</span><span class="mi">1</span> <span class="s">&quot;Hit return to continue&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">terminal</span> <span class="n">postscript</span> <span class="n">color</span>
</span><span class='line'><span class="n">set</span> <span class="n">output</span> <span class="s">&quot;strideread/strideread.ps&quot;</span>
</span><span class='line'><span class="n">splot</span> <span class="s">&#39;strideread/iozone_gen_out.gnuplot&#39;</span> <span class="n">using</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span> <span class="n">title</span> <span class="s">&quot;Stride read performance&quot;</span> <span class="n">with</span> <span class="n">lines</span>
</span><span class='line'>
</span><span class='line'><span class="n">set</span> <span class="n">terminal</span> <span class="n">x11</span>
</span><span class='line'><span class="n">set</span> <span class="n">title</span> <span class="s">&quot;Iozone performance&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">grid</span> <span class="ow">lt</span> <span class="mi">2</span> <span class="n">lw</span> <span class="mi">1</span>
</span><span class='line'><span class="n">set</span> <span class="n">surface</span>
</span><span class='line'><span class="n">set</span> <span class="n">xtics</span>
</span><span class='line'><span class="n">set</span> <span class="n">ytics</span>
</span><span class='line'><span class="n">set</span> <span class="n">logscale</span> <span class="n">x</span> <span class="mi">2</span>
</span><span class='line'><span class="n">set</span> <span class="n">logscale</span> <span class="n">y</span> <span class="mi">2</span>
</span><span class='line'><span class="n">set</span> <span class="n">autoscale</span> <span class="n">z</span>
</span><span class='line'><span class="c1">#set xrange [2.**5:2.**24]</span>
</span><span class='line'><span class="n">set</span> <span class="n">xlabel</span> <span class="s">&quot;File size in 2^n KBytes&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">ylabel</span> <span class="s">&quot;Record size in 2^n Kbytes&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">zlabel</span> <span class="s">&quot;Kbytes/sec&quot;</span>
</span><span class='line'><span class="c1">#set data style lines</span>
</span><span class='line'><span class="n">set</span> <span class="n">style</span> <span class="n">data</span> <span class="n">lines</span>
</span><span class='line'><span class="n">set</span> <span class="n">dgrid3d</span> <span class="mi">80</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span><span class="mi">3</span>
</span><span class='line'><span class="n">splot</span> <span class="s">&#39;fwrite/iozone_gen_out.gnuplot&#39;</span> <span class="n">using</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span> <span class="n">title</span> <span class="s">&quot;Fwrite performance&quot;</span> <span class="n">with</span> <span class="n">lines</span>
</span><span class='line'><span class="n">pause</span> <span class="o">-</span><span class="mi">1</span> <span class="s">&quot;Hit return to continue&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">terminal</span> <span class="n">postscript</span> <span class="n">color</span>
</span><span class='line'><span class="n">set</span> <span class="n">output</span> <span class="s">&quot;fwrite/fwrite.ps&quot;</span>
</span><span class='line'><span class="n">splot</span> <span class="s">&#39;fwrite/iozone_gen_out.gnuplot&#39;</span> <span class="n">using</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span> <span class="n">title</span> <span class="s">&quot;Fwrite performance&quot;</span> <span class="n">with</span> <span class="n">lines</span>
</span><span class='line'>
</span><span class='line'><span class="n">set</span> <span class="n">terminal</span> <span class="n">x11</span>
</span><span class='line'><span class="n">set</span> <span class="n">title</span> <span class="s">&quot;Iozone performance&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">grid</span> <span class="ow">lt</span> <span class="mi">2</span> <span class="n">lw</span> <span class="mi">1</span>
</span><span class='line'><span class="n">set</span> <span class="n">surface</span>
</span><span class='line'><span class="n">set</span> <span class="n">xtics</span>
</span><span class='line'><span class="n">set</span> <span class="n">ytics</span>
</span><span class='line'><span class="n">set</span> <span class="n">logscale</span> <span class="n">x</span> <span class="mi">2</span>
</span><span class='line'><span class="n">set</span> <span class="n">logscale</span> <span class="n">y</span> <span class="mi">2</span>
</span><span class='line'><span class="n">set</span> <span class="n">autoscale</span> <span class="n">z</span>
</span><span class='line'><span class="c1">#set xrange [2.**5:2.**24]</span>
</span><span class='line'><span class="n">set</span> <span class="n">xlabel</span> <span class="s">&quot;File size in 2^n KBytes&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">ylabel</span> <span class="s">&quot;Record size in 2^n Kbytes&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">zlabel</span> <span class="s">&quot;Kbytes/sec&quot;</span>
</span><span class='line'><span class="c1">#set data style lines</span>
</span><span class='line'><span class="n">set</span> <span class="n">style</span> <span class="n">data</span> <span class="n">lines</span>
</span><span class='line'><span class="n">set</span> <span class="n">dgrid3d</span> <span class="mi">80</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span><span class="mi">3</span>
</span><span class='line'><span class="n">splot</span> <span class="s">&#39;frewrite/iozone_gen_out.gnuplot&#39;</span> <span class="n">using</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span> <span class="n">title</span> <span class="s">&quot;Frewrite performance&quot;</span> <span class="n">with</span> <span class="n">lines</span>
</span><span class='line'><span class="n">pause</span> <span class="o">-</span><span class="mi">1</span> <span class="s">&quot;Hit return to continue&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">terminal</span> <span class="n">postscript</span> <span class="n">color</span>
</span><span class='line'><span class="n">set</span> <span class="n">output</span> <span class="s">&quot;frewrite/frewrite.ps&quot;</span>
</span><span class='line'><span class="n">splot</span> <span class="s">&#39;frewrite/iozone_gen_out.gnuplot&#39;</span> <span class="n">using</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span> <span class="n">title</span> <span class="s">&quot;Frewrite performance&quot;</span> <span class="n">with</span> <span class="n">lines</span>
</span><span class='line'>
</span><span class='line'><span class="n">set</span> <span class="n">terminal</span> <span class="n">x11</span>
</span><span class='line'><span class="n">set</span> <span class="n">title</span> <span class="s">&quot;Iozone performance&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">grid</span> <span class="ow">lt</span> <span class="mi">2</span> <span class="n">lw</span> <span class="mi">1</span>
</span><span class='line'><span class="n">set</span> <span class="n">surface</span>
</span><span class='line'><span class="n">set</span> <span class="n">xtics</span>
</span><span class='line'><span class="n">set</span> <span class="n">ytics</span>
</span><span class='line'><span class="n">set</span> <span class="n">logscale</span> <span class="n">x</span> <span class="mi">2</span>
</span><span class='line'><span class="n">set</span> <span class="n">logscale</span> <span class="n">y</span> <span class="mi">2</span>
</span><span class='line'><span class="n">set</span> <span class="n">autoscale</span> <span class="n">z</span>
</span><span class='line'><span class="c1">#set xrange [2.**5:2.**24]</span>
</span><span class='line'><span class="n">set</span> <span class="n">xlabel</span> <span class="s">&quot;File size in 2^n KBytes&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">ylabel</span> <span class="s">&quot;Record size in 2^n Kbytes&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">zlabel</span> <span class="s">&quot;Kbytes/sec&quot;</span>
</span><span class='line'><span class="c1">#set data style lines</span>
</span><span class='line'><span class="n">set</span> <span class="n">style</span> <span class="n">data</span> <span class="n">lines</span>
</span><span class='line'><span class="n">set</span> <span class="n">dgrid3d</span> <span class="mi">80</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span><span class="mi">3</span>
</span><span class='line'><span class="n">splot</span> <span class="s">&#39;fread/iozone_gen_out.gnuplot&#39;</span> <span class="n">using</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span> <span class="n">title</span> <span class="s">&quot;Fread performance&quot;</span> <span class="n">with</span> <span class="n">lines</span>
</span><span class='line'><span class="n">pause</span> <span class="o">-</span><span class="mi">1</span> <span class="s">&quot;Hit return to continue&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">terminal</span> <span class="n">postscript</span> <span class="n">color</span>
</span><span class='line'><span class="n">set</span> <span class="n">output</span> <span class="s">&quot;fread/fread.ps&quot;</span>
</span><span class='line'><span class="n">splot</span> <span class="s">&#39;fread/iozone_gen_out.gnuplot&#39;</span> <span class="n">using</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span> <span class="n">title</span> <span class="s">&quot;Fread performance&quot;</span> <span class="n">with</span> <span class="n">lines</span>
</span><span class='line'>
</span><span class='line'><span class="n">set</span> <span class="n">terminal</span> <span class="n">x11</span>
</span><span class='line'><span class="n">set</span> <span class="n">title</span> <span class="s">&quot;Iozone performance&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">grid</span> <span class="ow">lt</span> <span class="mi">2</span> <span class="n">lw</span> <span class="mi">1</span>
</span><span class='line'><span class="n">set</span> <span class="n">surface</span>
</span><span class='line'><span class="n">set</span> <span class="n">xtics</span>
</span><span class='line'><span class="n">set</span> <span class="n">ytics</span>
</span><span class='line'><span class="n">set</span> <span class="n">logscale</span> <span class="n">x</span> <span class="mi">2</span>
</span><span class='line'><span class="n">set</span> <span class="n">logscale</span> <span class="n">y</span> <span class="mi">2</span>
</span><span class='line'><span class="n">set</span> <span class="n">autoscale</span> <span class="n">z</span>
</span><span class='line'><span class="c1">#set xrange [2.**5:2.**24]</span>
</span><span class='line'><span class="n">set</span> <span class="n">xlabel</span> <span class="s">&quot;File size in 2^n KBytes&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">ylabel</span> <span class="s">&quot;Record size in 2^n Kbytes&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">zlabel</span> <span class="s">&quot;Kbytes/sec&quot;</span>
</span><span class='line'><span class="c1">#set data style lines</span>
</span><span class='line'><span class="n">set</span> <span class="n">style</span> <span class="n">data</span> <span class="n">lines</span>
</span><span class='line'><span class="n">set</span> <span class="n">dgrid3d</span> <span class="mi">80</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span><span class="mi">3</span>
</span><span class='line'><span class="n">splot</span> <span class="s">&#39;freread/iozone_gen_out.gnuplot&#39;</span> <span class="n">using</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span> <span class="n">title</span> <span class="s">&quot;Freread performance&quot;</span> <span class="n">with</span> <span class="n">lines</span>
</span><span class='line'><span class="n">pause</span> <span class="o">-</span><span class="mi">1</span> <span class="s">&quot;Hit return to exit&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="n">terminal</span> <span class="n">postscript</span> <span class="n">color</span>
</span><span class='line'><span class="n">set</span> <span class="n">output</span> <span class="s">&quot;freread/freread.ps&quot;</span>
</span><span class='line'><span class="n">splot</span> <span class="s">&#39;freread/iozone_gen_out.gnuplot&#39;</span> <span class="n">using</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span> <span class="n">title</span> <span class="s">&quot;Freread performance&quot;</span> <span class="n">with</span> <span class="n">lines</span>
</span></code></pre></td></tr></table></div></figure>


<h2>report.pl</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
</pre></td><td class='code'><pre><code class='perl'><span class='line'><span class="c1">#!/usr/bin/perl</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="c1"># arguments: one of more report files</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="c1"># Christian Mautner &lt;christian * mautner . ca&gt;, 2005-10-31</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="c1"># This script is based loosely on the Generate_Graph set</span>
</span><span class='line'><span class="c1"># of scripts that come with iozone, but is a complete re-write</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="c1"># The main reason to write this was the need to compare the behaviour of</span>
</span><span class='line'><span class="c1"># two or more different setups, for tuning filesystems or </span>
</span><span class='line'><span class="c1"># comparing different pieces of hardware.</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="c1"># This script is in the public domain, too short and too trivial</span>
</span><span class='line'><span class="c1"># to deserve a copyright.</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="c1"># Simply run iozone like, for example, ./iozone -a -g 4G &gt; config1.out (if your machine has 4GB)</span>
</span><span class='line'><span class="c1"># and then run perl report.pl config1.out</span>
</span><span class='line'><span class="c1"># or get another report from another box into config2.out and run</span>
</span><span class='line'><span class="c1"># perl report.pl config1.out config2.out</span>
</span><span class='line'><span class="c1"># the look in the report_* directory for .png</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="c1"># If you don&#39;t like png or the graphic size, search for &quot;set terminal&quot; in this file and put whatever gnuplot</span>
</span><span class='line'><span class="c1"># terminal you want. Note I&#39;ve also noticed that gnuplot switched the set terminal png syntax</span>
</span><span class='line'><span class="c1"># a while back, you might need &quot;set terminal png small size 900,700&quot;</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nv">@Reports</span><span class="o">=</span><span class="nv">@ARGV</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nb">die</span> <span class="s">&quot;usage: $0 &lt;iozone.out&gt; [&lt;iozone2.out&gt;...]\n&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="nv">@Reports</span> <span class="ow">or</span> <span class="nb">grep</span> <span class="p">(</span><span class="n">m</span><span class="o">|^-|</span><span class="p">,</span> <span class="nv">@Reports</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nb">die</span> <span class="s">&quot;report files must be in current directory&quot;</span> <span class="k">if</span> <span class="nb">grep</span> <span class="p">(</span><span class="n">m</span><span class="o">|/|</span><span class="p">,</span> <span class="nv">@Reports</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nv">%columns</span><span class="o">=</span><span class="p">(</span>
</span><span class='line'>         <span class="s">&#39;write&#39;</span>     <span class="o">=&gt;</span><span class="mi">3</span><span class="p">,</span>
</span><span class='line'>         <span class="s">&#39;read&#39;</span>      <span class="o">=&gt;</span><span class="mi">5</span><span class="p">,</span>
</span><span class='line'>         <span class="s">&#39;rewrite&#39;</span>   <span class="o">=&gt;</span><span class="mi">4</span><span class="p">,</span>
</span><span class='line'>         <span class="s">&#39;reread&#39;</span>    <span class="o">=&gt;</span><span class="mi">6</span><span class="p">,</span>
</span><span class='line'>         <span class="s">&#39;randread&#39;</span>  <span class="o">=&gt;</span><span class="mi">7</span><span class="p">,</span>
</span><span class='line'>         <span class="s">&#39;randwrite&#39;</span> <span class="o">=&gt;</span><span class="mi">8</span><span class="p">,</span>
</span><span class='line'>         <span class="s">&#39;bkwdread&#39;</span>  <span class="o">=&gt;</span><span class="mi">9</span><span class="p">,</span>
</span><span class='line'>         <span class="s">&#39;recrewrite&#39;</span><span class="o">=&gt;</span><span class="mi">10</span><span class="p">,</span>
</span><span class='line'>         <span class="s">&#39;strideread&#39;</span><span class="o">=&gt;</span><span class="mi">11</span><span class="p">,</span>
</span><span class='line'>         <span class="s">&#39;fwrite&#39;</span>    <span class="o">=&gt;</span><span class="mi">12</span><span class="p">,</span>
</span><span class='line'>         <span class="s">&#39;frewrite&#39;</span>  <span class="o">=&gt;</span><span class="mi">13</span><span class="p">,</span>
</span><span class='line'>         <span class="s">&#39;fread&#39;</span>     <span class="o">=&gt;</span><span class="mi">14</span><span class="p">,</span>
</span><span class='line'>         <span class="s">&#39;freread&#39;</span>   <span class="o">=&gt;</span><span class="mi">15</span><span class="p">,</span>
</span><span class='line'>         <span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="c1"># create output directory. the name is the concatenation</span>
</span><span class='line'><span class="c1"># of all report file names (minus the file extension, plus</span>
</span><span class='line'><span class="c1"># prefix report_)</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="nv">$outdir</span><span class="o">=</span><span class="s">&quot;report_&quot;</span><span class="o">.</span><span class="nb">join</span><span class="p">(</span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="nb">map</span><span class="p">{</span><span class="sr">/([^\.]+)(\..*)?/</span> <span class="o">&amp;&amp;</span> <span class="nv">$1</span><span class="p">}(</span><span class="nv">@Reports</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'><span class="k">print</span> <span class="bp">STDERR</span> <span class="s">&quot;Output directory: $outdir &quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="p">(</span> <span class="o">-</span><span class="n">d</span> <span class="nv">$outdir</span> <span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">print</span> <span class="bp">STDERR</span> <span class="s">&quot;(removing old directory) &quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nb">system</span> <span class="s">&quot;rm -rf $outdir&quot;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nb">mkdir</span> <span class="nv">$outdir</span> <span class="ow">or</span> <span class="nb">die</span> <span class="s">&quot;cannot make directory $outdir&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">print</span> <span class="bp">STDERR</span> <span class="s">&quot;done.\nPreparing data files...&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">foreach</span> <span class="nv">$report</span> <span class="p">(</span><span class="nv">@Reports</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nb">open</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="nv">$report</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">die</span> <span class="s">&quot;cannot open $report for reading&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nv">$report</span><span class="o">=~</span><span class="sr">/^([^\.]+)/</span><span class="p">;</span>
</span><span class='line'>    <span class="nv">$datafile</span><span class="o">=</span><span class="s">&quot;$1.dat&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nb">push</span> <span class="nv">@datafiles</span><span class="p">,</span> <span class="nv">$datafile</span><span class="p">;</span>
</span><span class='line'>    <span class="nb">open</span><span class="p">(</span><span class="n">O</span><span class="p">,</span> <span class="s">&quot;&gt;$outdir/$datafile&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">die</span> <span class="s">&quot;cannot open $outdir/$datafile for writing&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nb">open</span><span class="p">(</span><span class="n">O2</span><span class="p">,</span> <span class="s">&quot;&gt;$outdir/2d-$datafile&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">die</span> <span class="s">&quot;cannot open $outdir/$datafile for writing&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="k">while</span><span class="p">(</span><span class="sr">&lt;I&gt;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">next</span> <span class="k">unless</span> <span class="p">(</span><span class="sr"> /^[\s\d]+$/</span> <span class="p">);</span>
</span><span class='line'>        <span class="nv">@split</span> <span class="o">=</span> <span class="nb">split</span><span class="p">();</span>
</span><span class='line'>        <span class="c1"># We may have only 7 metrics (no block entries). Replaced == 15 with &gt;=8</span>
</span><span class='line'>        <span class="k">next</span> <span class="k">unless</span> <span class="p">(</span> <span class="nv">@split</span> <span class="o">&gt;=</span> <span class="mi">8</span> <span class="p">);</span>
</span><span class='line'>        <span class="k">print</span> <span class="n">O</span><span class="p">;</span>
</span><span class='line'>        <span class="k">print</span> <span class="n">O2</span> <span class="k">if</span> <span class="nv">$split</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">16384</span> <span class="ow">or</span> <span class="nv">$split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="nv">$split</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="nb">close</span> <span class="n">I</span><span class="p">,</span> <span class="n">O</span><span class="p">,</span> <span class="n">O2</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">print</span> <span class="bp">STDERR</span> <span class="s">&quot;done.\nGenerating graphs:&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">foreach</span> <span class="nv">$column</span> <span class="p">(</span><span class="nb">keys</span> <span class="nv">%columns</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">print</span> <span class="bp">STDERR</span> <span class="s">&quot; $column&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nb">open</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="s">&quot;&gt;$outdir/$column.do&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">die</span> <span class="s">&quot;cannot open $outdir/$column.do for writing&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="k">print</span> <span class="n">G</span> <span class="sx">qq{</span>
</span><span class='line'><span class="sx">set title &quot;Iozone performance: $column&quot;</span>
</span><span class='line'><span class="sx">set grid lt 2 lw 1</span>
</span><span class='line'><span class="sx">set surface</span>
</span><span class='line'><span class="sx">set parametric</span>
</span><span class='line'><span class="sx">set xtics</span>
</span><span class='line'><span class="sx">set ytics</span>
</span><span class='line'><span class="sx">set logscale x 2</span>
</span><span class='line'><span class="sx">set logscale y 2</span>
</span><span class='line'><span class="sx">set autoscale z</span>
</span><span class='line'><span class="sx">#set xrange [2.**5:2.**24]</span>
</span><span class='line'><span class="sx">set xlabel &quot;File size in KBytes&quot;</span>
</span><span class='line'><span class="sx">set ylabel &quot;Record size in Kbytes&quot;</span>
</span><span class='line'><span class="sx">set zlabel &quot;Kbytes/sec&quot;</span>
</span><span class='line'><span class="sx">#set data style lines</span>
</span><span class='line'><span class="sx">set style data lines</span>
</span><span class='line'><span class="sx">set dgrid3d 80,80,3</span>
</span><span class='line'><span class="sx">#set terminal png small picsize 900 700</span>
</span><span class='line'><span class="sx">set terminal png small size 900 700</span>
</span><span class='line'><span class="sx">set output &quot;$column.png&quot;</span>
</span><span class='line'><span class="sx">}</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">print</span> <span class="n">G</span> <span class="s">&quot;splot &quot;</span><span class="o">.</span> <span class="nb">join</span><span class="p">(</span><span class="s">&quot;, &quot;</span><span class="p">,</span> <span class="nb">map</span><span class="p">{</span><span class="sx">qq{&quot;$_&quot; using 1:2:$columns{$column} title &quot;$_&quot;}</span><span class="p">}(</span><span class="nv">@datafiles</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">print</span> <span class="n">G</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nb">close</span> <span class="n">G</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nb">open</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="s">&quot;&gt;$outdir/2d-$column.do&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">die</span> <span class="s">&quot;cannot open $outdir/$column.do for writing&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="k">print</span> <span class="n">G</span> <span class="sx">qq{</span>
</span><span class='line'><span class="sx">set title &quot;Iozone performance: $column&quot;</span>
</span><span class='line'><span class="sx">#set terminal png small picsize 450 350</span>
</span><span class='line'><span class="sx">set terminal png small size 450 350</span>
</span><span class='line'><span class="sx">set logscale x</span>
</span><span class='line'><span class="sx">set xlabel &quot;File size in KBytes&quot;</span>
</span><span class='line'><span class="sx">set ylabel &quot;Kbytes/sec&quot;</span>
</span><span class='line'><span class="sx">set output &quot;2d-$column.png&quot;</span>
</span><span class='line'><span class="sx">}</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">print</span> <span class="n">G</span> <span class="s">&quot;plot &quot;</span><span class="o">.</span> <span class="nb">join</span><span class="p">(</span><span class="s">&quot;, &quot;</span><span class="p">,</span> <span class="nb">map</span><span class="p">{</span><span class="sx">qq{&quot;2d-$_&quot; using 1:$columns{$column} title &quot;$_&quot; with lines}</span><span class="p">}(</span><span class="nv">@datafiles</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">print</span> <span class="n">G</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nb">close</span> <span class="n">G</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span> <span class="nb">system</span><span class="p">(</span><span class="s">&quot;cd $outdir &amp;&amp; gnuplot $column.do &amp;&amp; gnuplot 2d-$column.do&quot;</span><span class="p">)</span> <span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">print</span> <span class="bp">STDERR</span> <span class="s">&quot;(failed) &quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">print</span> <span class="bp">STDERR</span> <span class="s">&quot;(ok) &quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">print</span> <span class="bp">STDERR</span> <span class="s">&quot;done.\n&quot;</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/07/15/servlet-containers-startup-time/">Servlet Containers, Startup Time</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-07-15T02:11:03+02:00" pubdate data-updated="true">Jul 15<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>With the release of JBoss AS7, we see many comments around about the startup time of Application Servers.
Even if this appears marginal in real life (an application server is expected to run 24/24 7/7), there is area where startup time is still important like for developpers. In developpment phase, when you have to start/stop your server dozens of times by day, you need fastest start time as possible.</p>

<p>I conducted a very basic and simple test on my MacBook Pro, take various application servers and servlet containers and measure their startup time.</p>

<p>And in this days of Java 7 fever, try these servers with OpenJDK 7 (OS/X version).</p>

<h3>Results on MacBook Pro - Core2Duo 2.66Ghz</h3>

<p><img class="center" src="/images/Startup6.png"></p>

<p>all time in millisecondes</p>

<h3>Remarks</h3>

<ul>
<li><p>JBoss AS 6 (minimal profile) startup time was about 27s. I didn&#8217;t include it in graph to keep a good scale for others engines</p></li>
<li><p>JBoss AS6 seems to start well with OpenJDK 7 but was a bit long to stop, so I had to kill the process</p></li>
<li><p>JBoss AS7 web-profile and non certified full edition came with no webapp, so a bit less works at startup since no webapp has to be deployed and managed. Injecting a basic webapp take an extra 30ms on next starts.</p></li>
<li><p>All servers performed pretty the same under Apple JDK 1.6.0-26 and OpenJDK 7.</p></li>
</ul>


<h3>Conclusions</h3>

<ul>
<li><p>Jetty is still the fastest container to start around.</p></li>
<li><p>Apache Tomcat team does a good job on Apache Tomcat 7, near twice faster than Apache Tomcat 6 in startup time and not too far than Jetty.</p></li>
<li><p>JBoss AS7 startup speed improvements are tremendous, about 13 times faster than its predecessor JBoss AS6, congrats guys !</p></li>
</ul>


<p>Raw startup time data available <a href="https://gist.github.com/3807564">here</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/07/13/building-universal-apache-tomcat-native-library-on-osx/">Building Universal Apache Tomcat Native Library on OS/X</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-07-13T17:41:08+02:00" pubdate data-updated="true">Jul 13<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I recently notice that my Apache Tomcat running on OS/X 10.6.8 couldn&#8217;t use Apache Tomcat Native Library.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>INFO: The APR based Apache Tomcat Native library which allows optimal
</span><span class='line'>performance in production environments was not found on the
</span><span class='line'>java.library.path:
</span><span class='line'>.:/Library/Java/Extensions:/System/Library/Java/Extensions:/usr/lib/java
</span><span class='line'>Jul 13, 2011 11:02:30 AM org.apache.coyote.http11.Http11Protocol init
</span></code></pre></td></tr></table></div></figure>


<p>After digging around and with the help of ASFer Mladen Turk, I figure my previous build was stick to 64bits mode only and I switched my JVM to 32bits mode using -d32.</p>

<p>The fix was then easy, just had to rebuild tomcat-native and asking OS/X gcc to produce both 32/64 bits model library using the following CLFAGS/APXSLDFLAGS.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">CFLAGS</span><span class="o">=</span><span class="s1">&#39;-arch i386 -arch x86_64&#39;</span> <span class="nv">APXSLDFLAGS</span><span class="o">=</span><span class="s1">&#39;-arch i386-arch x86_64&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here is a small script I&#8217;m using now to produce Apache Tomcat Native Library on OS/X.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>curl http://mir2.ovh.net/ftp.apache.org/dist/tomcat/tomcat-connectors/native/1.1.23/source/tomcat-native-1.1.23-src.tar.gz -o tomcat-native-1.1.23-src.tar.gz
</span><span class='line'>tar xvzf tomcat-native-1.1.23-src.tar.gz
</span><span class='line'><span class="nb">cd </span>tomcat-native-1.1.23-src/jni/native
</span><span class='line'>
</span><span class='line'><span class="nv">CFLAGS</span><span class="o">=</span><span class="s1">&#39;-arch i386 -arch x86_64&#39;</span> <span class="nv">APXSLDFLAGS</span><span class="o">=</span><span class="s1">&#39;-arch i386 -arch x86_64&#39;</span> ./configure --with-apr<span class="o">=</span>/usr --with-ssl<span class="o">=</span>/usr --with-java-home<span class="o">=</span>/System/Library/Java/JavaVirtualMachines/1.6.0.jdk/Contents/Home --with-apxs<span class="o">=</span>/usr/sbin/apxs
</span><span class='line'>make clean
</span><span class='line'>make
</span><span class='line'>
</span><span class='line'>sudo cp .libs/libtcnative-1.0.1.23.dylib /usr/lib/java
</span><span class='line'>sudo rm -f  /usr/lib/java/libtcnative-1.dylib
</span><span class='line'>sudo ln -s /usr/lib/java/libtcnative-1.0.1.23.dylib /usr/lib/java/libtcnative-1.dylib
</span></code></pre></td></tr></table></div></figure>


<h3>A note about Lion</h3>

<p>If you get Java on Lion using the java command on terminal or via the Java Developer Package for Mac OS X 10.7, Java headers are not on the usual location and you could find them under <strong>/System/Library/Frameworks/JavaVM.framework/Versions/A/Headers</strong></p>

<p>You should then update the <strong>configure</strong> command line like this :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">CFLAGS</span><span class="o">=</span><span class="s1">&#39;-arch i386 -arch x86_64&#39;</span> <span class="nv">APXSLDFLAGS</span><span class="o">=</span><span class="s1">&#39;-arch i386 -arch x86_64&#39;</span> ./configure --with-apr<span class="o">=</span>/usr --with-apxs<span class="o">=</span>/usr/sbin/apxs --with-ssl<span class="o">=</span>/usr --with-java-home<span class="o">=</span>/System/Library/Frameworks/JavaVM.framework/Versions/A/
</span></code></pre></td></tr></table></div></figure>


<p>Lion came with Xcode 4.1 and there is also an impact on linker side, libtcnative is now produced as <strong>libtcnative-1.0.dylib</strong></p>

<p>Commands became so :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>curl http://mir2.ovh.net/ftp.apache.org/dist//tomcat/tomcat-connectors/native/1.1.23/source/tomcat-native-1.1.23-src.tar.gz -o tomcat-native-1.1.23-src.tar.gz
</span><span class='line'>tar xvzf tomcat-native-1.1.23-src.tar.gz
</span><span class='line'><span class="nb">cd </span>tomcat-native-1.1.23-src/jni/native
</span><span class='line'>
</span><span class='line'><span class="nv">CFLAGS</span><span class="o">=</span><span class="s1">&#39;-arch i386 -arch x86_64&#39;</span> <span class="nv">APXSLDFLAGS</span><span class="o">=</span><span class="s1">&#39;-arch i386 -arch x86_64&#39;</span> ./configure --with-apr<span class="o">=</span>/usr --with-apxs<span class="o">=</span>/usr/sbin/apxs --with-ssl<span class="o">=</span>/usr --with-java-home<span class="o">=</span>/System/Library/Frameworks/JavaVM.framework/Versions/A/
</span><span class='line'>make clean
</span><span class='line'>make
</span><span class='line'>
</span><span class='line'>sudo cp .libs/libtcnative-1.0.dylib /usr/lib/java
</span><span class='line'>sudo rm -f  /usr/lib/java/libtcnative-1.dylib
</span><span class='line'>sudo ln -s /usr/lib/java/libtcnative-1.0.dylib /usr/lib/java/libtcnative-1.dylib
</span></code></pre></td></tr></table></div></figure>


<p></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/04/18/apple-jdke28099s-openjdks-e28093-core2duo-vs-core-i7/">Apple JDK’s / OpenJDK&#8217;s – Core2Duo vs Core I7</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-04-18T21:39:20+02:00" pubdate data-updated="true">Apr 18<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Previously I did benchmark of Apple VMs and OpenJDK 6 and I wanted to see how all of the JVMs available today on our Mac on two systems, an old Core2Duo and a newer Core i7. And also see how they perform 32 / 64 bits kernel mode.</p>

<p>So I redo full dacapo bench suite to include OpenJDK 6, and we have now 5 VMs (3 Java 6 and 2 Java 7) :</p>

<ul>
<li><p>Apple Java 1.6.0_22 - Java HotSpot(TM) 64-Bit Server VM (build 17.1-b03-314, mixed mode)</p></li>
<li><p>Apple Java 1.6.0_24 - Java HotSpot(TM) 64-Bit Server VM (build 19.1-b02-348, mixed mode)</p></li>
<li><p>OpenJDK 7 bsd-port - OpenJDK 64-Bit Server VM (build 21.0-b07, mixed mode)</p></li>
<li><p>OpenJDK 7 macosx-port - OpenJDK 64-Bit Server VM (build 21.0-b07, mixed mode)</p></li>
<li><p>OpenJDK 6 macports - OpenJDK 64-Bit Server VM (build 17.0-b16, mixed mode)</p></li>
</ul>


<h3>Results on MacBook Pro - Core2Duo 2.66Ghz - 32bits kernel</h3>

<p>[table id=6 /]</p>

<p><a href="http://blog.hgomez.net/wp-content/uploads/2011/04/BenchJVMs-MBP.png"><img src="http://blog.hgomez.net/wp-content/uploads/2011/04/BenchJVMs-MBP-1024x555.png" alt="" /></a></p>

<h3>Results on iMac - Core i7 2.8Ghz -  64bits kernel</h3>

<p>[table id=5 /]</p>

<p><a href="http://blog.hgomez.net/wp-content/uploads/2011/04/BenchIMac.png"><img src="http://blog.hgomez.net/wp-content/uploads/2011/04/BenchIMac-1024x549.png" alt="" /></a></p>

<h2>Conclusion</h2>

<p>As seen if <a href="http://blog.hgomez.net/2011/04/16/apple-jdks-openjdk-back-to-benchs/">previous article</a>,  latest Apple JVM, 1.6.0-24 perform better than the old 1.6.0-22, and still behind OpenJDK 7 and even OpenJDK 6.  OpenJDK 7 bsd-port is still faster (by a small factor) than OpenJDK 7 from macosx-port (built with LLVM), in both simple threaded (Core2Duo, 2 cores) and large threaded (i7 4 cores with hyperthreading).</p>

<p>This benchmark show how good is <a href="http://ark.intel.com/Product.aspx?id=41316">Intel Core i7</a> comparing to previous generation <a href="http://ark.intel.com/Product.aspx?id=37130&amp;code=T9550">Intel Core2Duo</a>, roughly twice as fast.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/04/16/apple-jdks-openjdk-back-to-benchs/">Apple JDK&#8217;s / OpenJDK - Back to Benchs</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-04-16T16:52:06+02:00" pubdate data-updated="true">Apr 16<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>It&#8217;s good to see works in progress for Aqua/Cocoa - AWT ports but what about JVM performances ?</p>

<h2>Test vms</h2>

<p>I selected 4 VMs to be tested</p>

<p><code>
Apple Java 1.6.0_22 - java version "1.6.0_22"
Java(TM) SE Runtime Environment (build 1.6.0_22-b04-314-10M3406a)
Java HotSpot(TM) 64-Bit Server VM (build 17.1-b03-314, mixed mode)
</code></p>

<p><code>
Apple Java 1.6.0_24 - java version "1.6.0_24"
Java(TM) SE Runtime Environment (build 1.6.0_24-b07-348-10M3406a)
Java HotSpot(TM) 64-Bit Server VM (build 19.1-b02-348, mixed mode)
</code></p>

<p><code>
OpenJDK 7 bsd-port - openjdk version "1.7.0-internal"
OpenJDK Runtime Environment (build 1.7.0-internal-henri_2011_04_11_08_24-b00)
OpenJDK 64-Bit Server VM (build 21.0-b07, mixed mode)
</code></p>

<p><code>
OpenJDK 7 macosx-port - openjdk version "1.7.0-internal"
OpenJDK Runtime Environment (build 1.7.0-internal-b00)
OpenJDK 64-Bit Server VM (build 21.0-b07, mixed mode)
</code></p>

<h2>Test system</h2>

<p>My test system is an Apple iMac (iMac11,1 )  with Intel i7 2.80Ghz and 8Gb DDR3 1067Mhz, running under SnowLeopard 10.6.7 64bits.
I wanted to test 64bits VMs on a 64bits machine and this time use a stronger processor with more threads (ie: 4 cores with hyperthreading).</p>

<h3>DaCapo Benchmarks</h3>

<p>I keep the <a href="http://www.dacapobench.org/">DaCapo 9.12-bach</a>.</p>

<p>Bench tests launched with -n X, ie (java -jar dacapo-9.12-bach.jar -n 10 pmd)</p>

<p>[table id=4 /]</p>

<p><a href="http://blog.hgomez.net/wp-content/uploads/2011/04/Benchs4.png"><img src="http://blog.hgomez.net/wp-content/uploads/2011/04/Benchs4-1024x576.png" alt="" /></a></p>

<h2>Conclusion</h2>

<p>Latest Apple JVM, 1.6.0-24 perform better than the old 1.6.0-22 in all of the tests and is near OpenJDK 7 results.</p>

<p>OpenJDK 7 from the bsd-port perform a little better than the macosx-port. The main difference in build is bsd-port is using stock gcc whereas macos-port use llvm-gcc.</p>

<h3>bsd-port using stock-gcc during OpenJDK build</h3>

<p>[bash]
Compiling /Users/henri/Documents/jenkins/data/jobs/openjdk-1.7-bsdport-x86_64/workspace/hotspot/src/share/vm/adlc/arena.cpp
rm -f ../generated/adfiles/arena.o
/Users/henri/Documents/jenkins/data/jobs/openjdk-1.7-bsdport-x86_64/workspace/ALT_COMPILER_PATH/g++ -D_ALLBSD_SOURCE -D_GNU_SOURCE -DAMD64 -I/Users/henri/Documents/jenkins/data/jobs/openjdk-1.7-bsdport-x86_64/workspace/hotspot/src/share/vm/prims -I/Users/henri/Documents/jenkins/data/jobs/openjdk-1.7-bsdport-x86_64/workspace/hotspot/src/share/vm -I/Users/henri/Documents/jenkins/data/jobs/openjdk-1.7-bsdport-x86_64/workspace/hotspot/src/cpu/x86/vm -I/Users/henri/Documents/jenkins/data/jobs/openjdk-1.7-bsdport-x86_64/workspace/hotspot/src/os_cpu/bsd_x86/vm -I/Users/henri/Documents/jenkins/data/jobs/openjdk-1.7-bsdport-x86_64/workspace/hotspot/src/os/bsd/vm -I/Users/henri/Documents/jenkins/data/jobs/openjdk-1.7-bsdport-x86_64/workspace/hotspot/src/os/posix/vm -I/Users/henri/Documents/jenkins/data/jobs/openjdk-1.7-bsdport-x86_64/workspace/hotspot/src/share/vm/adlc -I../generated -DASSERT -DTARGET_OS_FAMILY_bsd -DTARGET_ARCH_x86 -DTARGET_ARCH_MODEL_x86_64 -DTARGET_OS_ARCH_bsd_x86 -DTARGET_OS_ARCH_MODEL_bsd_x86_64 -DTARGET_COMPILER_gcc -DCOMPILER2 -DCOMPILER1  -fno-rtti -fno-exceptions -pthread -fcheck-new -m64 -pipe -Werror -g -c -o ../generated/adfiles/arena.o /Users/henri/Documents/jenkins/data/jobs/openjdk-1.7-bsdport-x86_64/workspace/hotspot/src/share/vm/adlc/arena.cpp
[/bash]</p>

<h3>macosx-port using llvm-gcc during OpenJDK build</h3>

<p>[bash]
Compiling /Users/henri/Documents/jenkins/data/jobs/openjdk-1.7-macosx-universal/workspace/hotspot/src/share/vm/adlc/arena.cpp
rm -f ../generated/adfiles/arena.o
llvm-g++ -D_ALLBSD_SOURCE -D_GNU_SOURCE -DIA32 -I/Users/henri/Documents/jenkins/data/jobs/openjdk-1.7-macosx-universal/workspace/hotspot/src/share/vm/prims -I/Users/henri/Documents/jenkins/data/jobs/openjdk-1.7-macosx-universal/workspace/hotspot/src/share/vm -I/Users/henri/Documents/jenkins/data/jobs/openjdk-1.7-macosx-universal/workspace/hotspot/src/cpu/x86/vm -I/Users/henri/Documents/jenkins/data/jobs/openjdk-1.7-macosx-universal/workspace/hotspot/src/os_cpu/bsd_x86/vm -I/Users/henri/Documents/jenkins/data/jobs/openjdk-1.7-macosx-universal/workspace/hotspot/src/os/bsd/vm -I/Users/henri/Documents/jenkins/data/jobs/openjdk-1.7-macosx-universal/workspace/hotspot/src/os/posix/vm -I/Users/henri/Documents/jenkins/data/jobs/openjdk-1.7-macosx-universal/workspace/hotspot/src/share/vm/adlc -I../generated -DASSERT -DTARGET_OS_FAMILY_bsd -DTARGET_ARCH_x86 -DTARGET_ARCH_MODEL_x86_32 -DTARGET_OS_ARCH_bsd_x86 -DTARGET_OS_ARCH_MODEL_bsd_x86_32 -DTARGET_COMPILER_gcc -DCOMPILER2 -DCOMPILER1  -fno-rtti -fno-exceptions -pthread -fcheck-new -m32 -march=i586 -mstackrealign -pipe -Werror -g -c -o ../generated/adfiles/arena.o /Users/henri/Documents/jenkins/data/jobs/openjdk-1.7-macosx-universal/workspace/hotspot/src/share/vm/adlc/arena.cpp
[/bash]</p>

<p>Performances gain in OpenJDK7 VM vs latest Apple 6 VM is smaller than previously (see previous articles on Apple JDK vs OpenJDK 6), switching to OpenJDK 7 will not be only for pure speed but for functionalities.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/04/16/openjdk-7-on-osx-first-swing-app/">OpenJDK 7 on OS/X and IntelliJ IDEA EAP</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-04-16T16:16:27+02:00" pubdate data-updated="true">Apr 16<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>During the last weeks, Apple started to contribute it&#8217;s Aqua/Cocoa port to OpenJDK 7 on the macosx-port branch. It&#8217;s still works it progress but it was nice to see some SWING apps like IntelliJ IDEA works on the preliminary release.</p>

<p>I used IntelliJ IDEA EAP (10.5) and tweaked it&#8217;s startup shell.sh to define AWT_TOOLKIT=CToolkit and add -Dswing.defaultlaf=com.apple.laf.AquaLookAndFeel since Aqua Look and Feel is not default for now.</p>

<p>[bash]
export CLASSPATH</p>

<p>LD_LIBRARY_PATH=.:$LD_LIBRARY_PATH
export LD_LIBRARY_PATHAWT_TOOLKIT</p>

<h1>AWT/Cocoa port for OpenJDK 7 macosx-port</h1>

<p>export=CToolkit
JVM_ARGS=&#8221;-Dswing.defaultlaf=com.apple.laf.AquaLookAndFeel $JVM_ARGS&#8221;</p>

<p>cd &#8220;$IDEA_BIN_HOME&#8221;
while true ; do
  $IDEA_JDK/bin/java $JVM_ARGS -Djb.restart.code=88 $IDEA_MAIN_CLASS_NAME $*
  test $? -ne 88 &amp;&amp; break
done</p>

<p>[/bash]</p>

<p>Then defined OpenJDK 7 from macosx port (available <a href="http://openjdk-osx-build.googlecode.com/files/OpenJDK-OSX-1.7-universal-20110416.dmg">here</a>) as default JVM and started IntelliJ by calling its shell script :</p>

<p>[bash]
export JAVA_HOME=/Library/Java/JavaVirtualMachines/1.7.0.jdk/Contents/Home
/Applications/IdeaX-IU-106.396.app/bin/idea.sh
[/bash]</p>

<p>And I could see a Swing based application running on OpenJDK 7 and OS/X.</p>

<p><a href="http://blog.hgomez.net/wp-content/uploads/2011/04/IntelliJ-OpenJDK7-UI.png"><img src="http://blog.hgomez.net/wp-content/uploads/2011/04/IntelliJ-OpenJDK7-UI-1024x745.png" alt="" /></a></p>

<p>IntelliJ IDEA is so the second major IDE to be compatible with OpenJDK 7 and OS/X - Cocoa, first one was Eclipse thanks to it&#8217;s SWT/Cocoa bridge.
I tested with both NetBeans 7 RC1 and RC2 but it didn&#8217;t works. I hope it will be fixed in NetBeans 7 final release.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/03/11/maven-tomcat-plugin-and-post-6-0-29-tomcat/">Tomcat Maven Plugin and Apache Tomcat Post 6.0.29</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-03-11T13:56:04+01:00" pubdate data-updated="true">Mar 11<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>If you&#8217;re using the <a href="http://mojo.codehaus.org/tomcat-maven-plugin/">Tomcat Maven Plugin</a> and want to use post 6.0.29  Apache Tomcat, ie latest 6.0.32, you should update your pom to handle a change in artifact.</p>

<p>Up to 6.0.29, Eclipse JDT compiler was bundled as jasper-jdt :</p>

<p>[xml]
<dependency></p>

<pre><code>          &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;
          &lt;artifactId&gt;jasper-jdt&lt;/artifactId&gt;
          &lt;version&gt;6.0.29&lt;/version&gt;
        &lt;/dependency&gt;
</code></pre>

<p>[/xml]</p>

<p>With <a href="http://tomcat.apache.org/tomcat-6.0-doc/changelog.html">6.0.30</a>, Apache Tomcat team started to bundle Eclipse JDT directly:</p>

<p>[xml]
<dependency>
  <groupId>org.eclipse.jdt.core.compiler</groupId>
  <artifactId>ecj</artifactId>
  <version>3.5.1</version>
</dependency>
[/xml]</p>

<p>As consequence, org.apache.tomcat/jasper-jdt artifact didn&#8217;t exist anymore after release 6.0.29.</p>

<p>[caption id=&#8221;attachment_742&#8221; align=&#8221;alignnone&#8221; width=&#8221;743&#8221; caption=&#8221;Jasper JDT up to 6.0.29&#8221;]<a href="http://blog.hgomez.net/wp-content/uploads/2011/03/jasper-jdt.png"><img src="http://blog.hgomez.net/wp-content/uploads/2011/03/jasper-jdt.png" alt="Jasper JDT up to 6.0.29" /></a>[/caption]</p>

<p>For Tomcat Maven Plugin, you should update the <a href="http://mojo.codehaus.org/tomcat-maven-plugin/examples/adjust-embedded-tomcat-version.html">suggested pom</a> like this :</p>

<p>[xml]</p>

<pre><code>&lt;build&gt;
    &lt;pluginManagement&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
                &lt;artifactId&gt;tomcat-maven-plugin&lt;/artifactId&gt;
                &lt;version&gt;1.2-SNAPSHOT&lt;/version&gt;
                &lt;dependencies&gt;
                    &lt;dependency&gt;
                        &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;
                        &lt;artifactId&gt;catalina&lt;/artifactId&gt;
                        &lt;version&gt;${tomcat.version}&lt;/version&gt;
                    &lt;/dependency&gt;
                    &lt;dependency&gt;
                        &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;
                        &lt;artifactId&gt;catalina-ha&lt;/artifactId&gt;
                        &lt;version&gt;${tomcat.version}&lt;/version&gt;
                        &lt;scope&gt;runtime&lt;/scope&gt;
                    &lt;/dependency&gt;
                    &lt;dependency&gt;
                        &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;
                        &lt;artifactId&gt;tribes&lt;/artifactId&gt;
                        &lt;version&gt;${tomcat.version}&lt;/version&gt;
                        &lt;scope&gt;runtime&lt;/scope&gt;
                    &lt;/dependency&gt;
                    &lt;dependency&gt;
                        &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;
                        &lt;artifactId&gt;el-api&lt;/artifactId&gt;
                        &lt;version&gt;${tomcat.version}&lt;/version&gt;
                        &lt;scope&gt;runtime&lt;/scope&gt;
                    &lt;/dependency&gt;
                    &lt;dependency&gt;
                        &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;
                        &lt;artifactId&gt;jasper&lt;/artifactId&gt;
                        &lt;version&gt;${tomcat.version}&lt;/version&gt;
                        &lt;scope&gt;runtime&lt;/scope&gt;
                    &lt;/dependency&gt;
                    &lt;dependency&gt;
                        &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;
                        &lt;artifactId&gt;jasper-el&lt;/artifactId&gt;
                        &lt;version&gt;${tomcat.version}&lt;/version&gt;
                        &lt;scope&gt;runtime&lt;/scope&gt;
                    &lt;/dependency&gt;
                    &lt;dependency&gt;
                        &lt;groupId&gt;org.eclipse.jdt.core.compiler&lt;/groupId&gt;
                        &lt;artifactId&gt;ecj&lt;/artifactId&gt;
                        &lt;version&gt;3.5.1&lt;/version&gt;
                        &lt;scope&gt;runtime&lt;/scope&gt;
                    &lt;/dependency&gt;
                    &lt;dependency&gt;
                        &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;
                        &lt;artifactId&gt;jsp-api&lt;/artifactId&gt;
                        &lt;version&gt;${tomcat.version}&lt;/version&gt;
                        &lt;scope&gt;runtime&lt;/scope&gt;
                    &lt;/dependency&gt;
                    &lt;dependency&gt;
                        &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;
                        &lt;artifactId&gt;servlet-api&lt;/artifactId&gt;
                        &lt;version&gt;${tomcat.version}&lt;/version&gt;
                        &lt;scope&gt;runtime&lt;/scope&gt;
                    &lt;/dependency&gt;
                    &lt;dependency&gt;
                        &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;
                        &lt;artifactId&gt;coyote&lt;/artifactId&gt;
                        &lt;version&gt;${tomcat.version}&lt;/version&gt;
                        &lt;scope&gt;runtime&lt;/scope&gt;
                    &lt;/dependency&gt;
                    &lt;dependency&gt;
                        &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;
                        &lt;artifactId&gt;dbcp&lt;/artifactId&gt;
                        &lt;version&gt;${tomcat.version}&lt;/version&gt;
                        &lt;scope&gt;runtime&lt;/scope&gt;
                    &lt;/dependency&gt;
                &lt;/dependencies&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/pluginManagement&gt;
</code></pre>

<p>[/xml]</p>

<h3>Notice: An updated version of Tomcat Maven Plugin 1.2-SNAPSHOT has been released, this hack is no more necessary</h3>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/12/04/openjdk-1-7-for-osx-benchs/">OpenJDK 1.7 for OS/X Benchs</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-12-04T11:17:10+01:00" pubdate data-updated="true">Dec 4<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>After building and packaging OpenJDK 1.7 for OS/X, I wanted to see how performed new VMs.</p>

<h2>Test vms</h2>

<p>Recents OpenJDK 1.7 32 and 64bits where used :</p>

<p><code>
openjdk version "1.7.0-internal"
OpenJDK Runtime Environment (build 1.7.0-internal-henri_2010_12_01_00_46-b00)
OpenJDK Server VM (build 20.0-b02, mixed mode)
</code></p>

<p><code>
openjdk version "1.7.0-internal"
OpenJDK Runtime Environment (build 1.7.0-internal-henri_2010_12_01_00_49-b00)
OpenJDK 64-Bit Server VM (build 20.0-b02, mixed mode)
</code></p>

<h2>Test system</h2>

<p>My test system is an Apple Mac Book Pro (MacBookPro5,1) with Intel Core 2 Duo 2.66Ghz and 4Gb DDR3 1067Mhz, running under SnowLeopard 10.6.5 32bits.</p>

<h3>DaCapo Benchmarks</h3>

<p>I used again <a href="http://www.dacapobench.org/">DaCapo 9.12-bach</a>, discarding <strong>batik</strong> test, this one requiring a working AWT/Swing support .</p>

<p>Bench tests launched with -n X, ie (java -jar dacapo-9.12-bach.jar -n 10 pmd)</p>

<p>[table id=3 /]</p>

<h2>Conclusion</h2>

<p>Good news, two tests <strong>Tomcat</strong> and <strong>tradebeans</strong> now pass the bench</p>

<p>OpenJDK 1.7 64bits perform better than OpenJDK 1.7 32bits and OpenJDK 6.</p>

<p>Even if OpenJDK 1.7 32bits performances are better than Apple Java 6, it&#8217;s allways behind OpenJDK 1.7 64bits version on OS/X, so you should select the 64bits version if performance is the key for your use.</p>

<p>Next article will cover OpenJDK 1.7 and <a href="http://openjdk.java.net/jtreg/">jtreg</a>, the Regression Test Harness for the OpenJDK platform.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/11/26/openjdk-1-7-for-osx-continuous-build-with-hudson-e28093-episode-3/">OpenJDK 1.7 for OS/X Continuous Build With Hudson – Episode 3</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-26T10:55:36+01:00" pubdate data-updated="true">Nov 26<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Gildas and I create a project on GoogleCode where we&#8217;ll maintain build/package scripts and provide packages.</p>

<p>My Dropbox download page was overloaded and we needed another location, here is it :</p>

<p><a href="http://code.google.com/p/openjdk-osx-build/">http://code.google.com/p/openjdk-osx-build/</a></p>

<p>Contributors are very welcome, especially OS/X gurus</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/3/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>About Me</h1>
  <p>OSS activist, ASF Member, former Tomcat contributor, founder of JPackage, DevOps Incubator and OBuildFactory projects. Dev, QA and Ops.</p>
  <p>Living in Challes-les-Eaux, French Alps.</p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/07/22/refresh/">Refresh</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/10/15/mountain-lion-apxs/">Mountain Lion and apxs</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/07/20/understanding-java-from-command-line-on-osx/">Understanding java from command line on OSX</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/06/13/building-universal-apache-tomcat-native-library-on-osx-updated/">Building Universal Apache Tomcat Native Library on OS/X - updated</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/03/21/using-apache-tomcat-connector-mod_jk-on-osx/">Using Apache Tomcat Connector (mod_jk) on OSX</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("hgomez", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/hgomez" class="twitter-follow-button" data-show-count="false">Follow @hgomez</a>
  
</section>


<section>
  <h1>On Delicious</h1>
  <div id="delicious"></div>
  <script type="text/javascript" src="http://feeds.delicious.com/v2/json/henri.gomez?count=3&amp;sort=date&amp;callback=renderDeliciousLinks"></script>
  <p><a href="http://delicious.com/henri.gomez">My Delicious Bookmarks &raquo;</a></p>
</section>


  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Henri Gomez -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
