---
comments: true
date: 2010-01-08 21:09:42
layout: post
slug: computer-archeology-resurrect-jonama
title: Computer Archeology - Resurrect Jonama
wordpress_id: 414
categories:
- developpement
---

A long time ago, in a not so distant galaxy, I wrote a SSL relay, named [Jonama](http://membres.multimania.fr/jonama/).

This SSL relay was used in-house for some specifics applications and was working with a glitch since 1999.

This week, we upgraded our web servers to new boxes running Suse SLES 11.
And as expected, the relay didn't work anymore since Suse SLES 11 came with OpenSSL 0.9.8k, so I had to do some archeology.

Native C code, RPM specfiles, autoconf and figure what changed in recent OpenSSL.

Here is the result, saved here in my blog.

[jonama-1.1.5-0.src.rpm](/bin-contents/jonama-1.1.5-0.src.rpm)

[jonama-1.1.5.tar.gz](/bin-contents/jonama-1.1.5.tar.gz)

For those interested on Jonama, a copy from my original site :

[![Logo de Jonama](/wp-content/uploads/2011/12/jonama.gif)](/wp-content/uploads/2011/12/jonama.gif)

**What's this ?**



* * *

**Jonama **is a piece of software acting as a relay between a client over the Net and your internal systems.

It was developped which security in mind :



	
  * Use of SSL protocol to identify remotes and crypt channels.

	
  * Use of Unix mechanisms like chroot and setuid, to minimize rights and actions.


**Why ?**



* * *

I was looking for an SSL relay but each implementation (sslwrap, stunnel, bjorb) didn't support CA mode and load-balancing.

Since I work on RPM for mod_ssl, I decided to grab parts of this software to start my very own SSL relay. 

Today, June 1999, stunnel also support CA mode ;-)

**Current Features**



* * *

As of version 1.1.x :



	
  * Stand-alone server (no use of inetd wrapper).

	
  * SSL v2/v3/TLS 1 via OpenSSL/SSLeay.

	
  * Multiples services proxying (ie telnet, imap, pop).

	
  * CA mode for reject of clients without valid certificates (SSLeay CA.sh).

	
  * Services could use multiples remotes servers, with automatic backup .

	
  * Relaying control via ACL Date/Time.

	
  * Free software.


**What are the necessary step after installing jonama ?**



* * *





	
  * run **jmca** to build your CA certificate.

	
  * run **jgenscert** to build proxy certificate

	
  * run now **jmca** to build users certificates


Since all **Jonama **configuration files are put under the **/etc/jonama/conf** directory, I create there one (or more) ssl sub-directories where I put all needed CA's file .

**For security concern, be sure the directory will be restricted to root access and files only readable by root !!!.**

**I'm not using RPM based system, what initialization step needed ?**



* * *





	
  * Modify makefile to follow your system (ssl lib location..)

	
  * **make install**** **(jmca and jgenscrt are executed)



**I allready have a real www certificate, Can I use it ?**



* * *

Yes but only for proxy identification. You must be your own custom ca to handle clients certs generations.

But you are free to use you www certificate (pem encoded) to identify your proxy to your clients, instead of using a self signed certificate.
To use your web certificate (generated by Thawte for example), simply replace the self genarated certificate (created by **jgencert**), **/etc/jonama/conf/ssl/server.crt** and private key **/etc/jonama/conf/ssl/private/server.key** by your web certificate and key :

**cp wwwserver.pem /etc/jonama/conf/ssl.crt/server.crt**
**cp wwwkey.pem /etc/jonama/conf/ssl.key/server.key**

**How to remove the pass-phrase from my private key ?**



* * *

Thinking that Jonama can provide a different CA for the different services, you could want avoid entering the pass-phrase for each private key .  ****





**openssl rsa -in key1.key -out key2.key **([SSLeay FAQ](http://www.psy.uq.oz.au/~ftp/Crypto/#remove%20a%20passphrase%20from%20a%20private%20key)) 



